# 流域划分数据预处理流程（以亚洲为例）



## 一、原始栅格数据处理

### 1.1 获取数据

根据HydroBasins第一级流域的范围，确定栅格数据的范围。

例如，亚洲的范围 57.61°E ~ 150.92°E，1.17°N ~ 55.93°N。

对应栅格数据的范围 n00e055 ~ n55e0155。

### 1.2 处理分块流向栅格数据

将分块流向栅格数据导入到ArcMap等可视化GIS软件中，目视检查。

如果该块流向栅格数据与亚洲范围没有相交的部分，则舍去该块数据。

如果该块流向栅格数据与亚洲范围有相交的部分，则按一下顺序处理。

① 如果栅格数据内存在不属于亚洲的岛屿时，需要画辅助线，去除栅格数据内不属于亚洲的岛屿。

② 如果栅格数据内存在不属于亚洲的海陆边界时（流向=0），参考HydroBasins第一级流域的范围，在海陆边界上取一个点，将海陆边界分为两个部分，再将不属于亚洲的那一部分设为NoData（流向=247）。

③ 如果不属于以上两种情况，则不做处理。

### 1.3 拼接流向栅格数据

将处理后的分块流向栅格数据拼接为一幅数据。可以使用提供的python脚本，也可以使用 gdal_merge.py

### 1.4 提取亚洲范围内的内流区终点

读取拼接后的流向栅格数据，找出所有的内流区终点（流向=255）。判断内流区终点是否在HydroBasins亚洲区域的第一级流域范围内。只保留亚洲范围内的内流区终点。

### 1.5 追踪完整的亚洲流向范围

从所有的海陆边界（流向=0）和亚洲范围内的内流区终点（流向=255）开始逆流向追踪，保存为0,1栅格数据，作为亚洲区域的掩膜文件。

### 1.6 分块掩膜数据

将掩膜数据分块，分块大小与原来一致。再将分块数据导入到ArcMap等可视化GIS软件中，目视检查范围是否合理

### 1.7 拼接亚洲范围栅格数据（包括流向、汇流累计量和高程）

利用上一步得到的掩膜数据，对原始栅格数据进行掩膜操作，只保留亚洲部分的数据，并拼接为一幅数据。



------

## 二、去除海陆边界上的一些凸出部分

### 2.1 为什么要去除海陆边界上的凸出部分？

预期一条入海河流的入海口，可以将海岸线（流向=0）分为两个部分。如果入海口处仍有陆地向外延伸，则会将海岸线分为三个部分，不符合程序设计的基本假设。

### 2.2 如何找到凸出部分

① 定义河网的阈值。

② 在河流入海口处，将海岸线打断成若干个部分，并基于四邻域连通性，标记打断后的海岸线。

③ 如果一个河流入海口的四邻域范围内有3个不同的标记（且都不为0），则说明这3个标记内有一个是凸出部分。

注：找到凸出部分的数量与河网阈值有关

### 2.3 按什么标准去除凸出部分

一般而言，凸出部分的面积都极小，可以通过面积确定。

统计3个不同的标记对应的汇流累积量，找到汇流累积量最小的那一个标记（大多数情况下只有1个像元），将栅格数据（流向，汇流累积量，高程）对应位置处设为0值。

如果有特殊情况发生，也可以目视检查，决定到底哪一块是凸出。